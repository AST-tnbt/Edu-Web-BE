# =========================================================
# üöÄ BASIC CONFIGURATION
# =========================================================
spring.application.name=apigateway
server.port=8080

# =========================================================
# üß≠ EUREKA CLIENT CONFIG
# =========================================================
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
eureka.instance.prefer-ip-address=true

# =========================================================
# üîÅ GATEWAY ROUTES CONFIGURATION
# =========================================================
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# üö¶ Static routes
spring.cloud.gateway.routes[0].id=authservice
spring.cloud.gateway.routes[0].uri=lb://AUTHSERVICE
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/auth/**

spring.cloud.gateway.routes[1].id=userservice
spring.cloud.gateway.routes[1].uri=lb://USERSERVICE
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/users/**

# =========================================================
# üîí JWT FILTER CONFIG (n·∫øu c√≥)
# =========================================================
jwt.secret=2L7OaWJq8w3sM7vM8q5Gq0Wz6JfYzI6aQyd0NgqfFs8=
jwt.header=Authorization
jwt.prefix=Bearer 

# =========================================================
# üåê CORS CONFIGURATION
# =========================================================
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedOrigins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:4200}
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.corsConfigurations.[/**].allowCredentials=true

# =========================================================
# üìú LOGGING & DEBUGGING
# =========================================================
logging.level.org.springframework.cloud.gateway=INFO
logging.level.reactor.netty.http.client=INFO
logging.level.org.springframework.web=INFO

# =========================================================
# üß∞ ACTUATOR (optional)
# =========================================================
management.endpoints.web.exposure.include=health,info,metrics,gateway
management.endpoint.gateway.enabled=true
management.endpoint.health.probes.enabled=true

# Rate Limiting (RedisRateLimiter)
spring.cloud.gateway.redis.enabled=true
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}

# Apply default rate limiter via filter name in routes
# spring.cloud.gateway.default-filters[0]=RequestRateLimiter
# spring.cloud.gateway.default-filters[1].name=RequestRateLimiter
# spring.cloud.gateway.default-filters[1].args.redis-rate-limiter.replenishRate=10
# spring.cloud.gateway.default-filters[1].args.redis-rate-limiter.burstCapacity=20
# spring.cloud.gateway.default-filters[1].args.key-resolver=#{@ipKeyResolver}
